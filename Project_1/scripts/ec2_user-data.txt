#!/bin/bash

sudo yum update -y
sudo yum install git curl nginx cronie -y

git clone https://github.com/gabrielng-rj99/PB-CompassUOL-GabrielGomesDev

sudo systemctl start crond
sudo systemctl enable crond
sudo systemctl start nginx
sudo systemctl enable nginx
sudo systemctl restart nginx

sudo rm -rf ~/PB-CompassUOL-GabrielGomesDev/
git clone https://github.com/gabrielng-rj99/PB-CompassUOL-GabrielGomesDev

sudo cp -R ~/PB-CompassUOL-GabrielGomesDev/website/* /usr/share/nginx/html

sudo systemctl restart crond
sudo systemctl restart nginx

VERIFY_NGINX="*/5 * * * * ~/PB-CompassUOL-GabrielGomesDev/Project_1/scripts/verify-nginx.sh"
START_INSTANCE="@reboot ~/PB-CompassUOL-GabrielGomesDev/Project_1/scripts/start_instance.sh"

(crontab -l | grep -q "$VERIFY_NGINX") || (crontab -l; echo "$VERIFY_NGINX") | crontab -
(crontab -l | grep -q "$START_INSTANCE") || (crontab -l; echo "$START_INSTANCE") | crontab -